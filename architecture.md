# 시스템 아키텍처 문서 (Architecture)

---

## 1. 시스템 개요

이 시스템은 GPT가 전략을 직접 생산하는 완전 자동화 트레이딩 파이프라인입니다. 데이터 수집부터 전략 생산, 실행, 피드백, 대시보드까지 모든 과정을 모듈화하여 관리하며, 각 모듈은 사양서와 코드가 1:1로 대응됩니다. 도식.md의 플로우차트에 따라 실제 운영 흐름과 예외처리, 피드백, 대시보드 제어까지 현실적으로 설계되어 있습니다.

- **공통유틸(utils) 모듈(설정, 로깅, 에러처리 등)은 src/utils/ 하위에 별도 관리되며, 모든 레이어/모듈에서 재사용됩니다.**
- **전략 엔진 하위에 backtest(백테스트), simulator(시뮬레이션) 모듈이 포함되어 있어, 모든 전략/이벤트/데이터 모듈의 성능과 안정성을 실전 전 미리 검증/실험할 수 있습니다.**

---

## 2. 전체 구조 및 데이터 흐름

```mermaid
flowchart TD

%% === 1. 데이터 수집 및 준비 ===
A["데이터 수집\n(시장, 뉴스, 소셜, 외부 API)"] --> B["데이터 전처리 / 정제"]
B --> C["DB / 메모리 캐시\n(상태, 포트폴리오, 시장데이터)"]
C --> D["트리거 / 이벤트 감지"]

%% === 2. 전략 판단 ===
D --> E{"전략 판단이 필요한가?"}
E -- "예" --> F["GPT 전략 컨트롤러\n(전략 수립 / 리밸런싱 / 리스크관리)"]
E -- "아니오" --> G["로컬 전략 엔진\n(단순 / 반복 처리)"]
F --> H["매매 / 포트폴리오 전략 생성"]
G --> H

%% === 3. 주문 및 실행 ===
H --> X1{"예산 / 수수료 / 리스크 초과?"}
X1 -- "예" --> X2["경고 및 전략 조정"]
X2 --> F
X1 -- "아니오" --> I["주문 실행기\n(거래소 API 주문 체결)"]

I --> J{"주문 성공 여부?"}
J -- "예" --> K["포트폴리오 / 상태 업데이트"]
J -- "아니오" --> L["1회 재시도"]
L --> M{"재시도도 실패?"}
M -- "예" --> N["사용자 알림 / Fallback 전략"]
M -- "아니오" --> K

%% === 4. 로그, 알림, UI ===
K --> O["의사결정 로그 기록"]
N --> O
O --> P["모니터링 / 알림 시스템"]
P --> Q["대시보드 / 실시간 시각화"]

%% === 5. 전략 피드백 루프 ===
Q --> R{"피드백이 긍정적인가?"}
R -- "예" --> S["전략 유지"]
R -- "아니오" --> T["전략 검토 및 조정"]
T --> F

%% === 6. 동적 전략 조정 ===
F --> U{"시장 변화 / 외부 요인 발생?"}
U -- "있음" --> V["머신러닝 기반 전략 보정\n또는 외부 도구 연동"]
V --> F
U -- "없음" --> W["기본 전략 유지"]
W --> H

%% === 7. 규제 및 컴플라이언스 ===
F --> AA["규제 / 세금 / 법적 검토"]
AA --> F

%% === 8. 대시보드 제어 계층 ===
subgraph Dashboard [대시보드 제어 계층]
    DA[사용자 조작\n(시작/중지/설정 변경)] --> DB[대시보드 UI]
    DB --> DC["제어 명령 전송\n(API 호출 / WebSocket)"]
    DC --> F
    DB --> DD["상태 요청\n(전략 상태, 자산, 에러 등)"]
    DD --> C
    DD --> O
    DB --> P
end
```

---

## 3. 주요 단계별 상세 설명

### 3.1 데이터 수집 및 준비
- 시장, 뉴스, 소셜, 외부 API 등 다양한 소스에서 실시간 데이터 수집
- 수집된 데이터는 전처리/정제 과정을 거쳐 DB/메모리 캐시에 저장
- 포트폴리오, 시장데이터, 상태 정보 등도 함께 관리

### 3.2 트리거/이벤트 감지
- 전처리된 데이터에서 트리거(특정 조건, 신호 등) 감지
- 이벤트 발생 시 전략 판단 단계로 진입

### 3.3 전략 판단 및 생성
- 전략 판단이 필요한 경우 GPT 전략 컨트롤러가 전략 수립, 리밸런싱, 리스크관리 수행
- 단순/반복 처리는 로컬 전략 엔진에서 처리
- 전략 생성 후, 예산/수수료/리스크 초과 여부를 체크
- 초과 시 경고 및 전략 조정, 아니면 주문 실행기로 이동

### 3.4 주문 및 실행
- 거래소 API를 통해 실제 주문 체결
- 주문 실패 시 1회 재시도, 재시도도 실패하면 사용자 알림 및 Fallback 전략 적용
- 주문 성공 시 포트폴리오/상태 업데이트

### 3.5 로그, 알림, 대시보드
- 모든 의사결정/실행 내역은 로그로 기록
- 모니터링/알림 시스템을 통해 실시간 상태 전달
- 대시보드에서 실시간 시각화 및 사용자 피드백 제공

### 3.6 전략 피드백 루프
- 대시보드/모니터링 결과가 긍정적이면 전략 유지, 아니면 전략 검토 및 조정
- 전략 검토/조정은 다시 GPT 전략 컨트롤러로 피드백

### 3.7 동적 전략 조정
- 시장 변화/외부 요인 발생 시 머신러닝 기반 전략 보정 또는 외부 도구 연동
- 변화가 없으면 기본 전략 유지

### 3.8 규제 및 컴플라이언스
- 전략 수립 단계에서 규제, 세금, 법적 검토를 반드시 거침
- 필요시 전략 재조정

### 3.9 대시보드 제어 계층
- 사용자는 대시보드 UI를 통해 전략 시작/중지/설정 변경 등 제어 가능
- 대시보드에서 전략 상태, 자산, 에러 등 실시간 요청/조회 가능
- 모든 상태/알림/로그는 대시보드와 연동

---

## 4. 기술스택 및 특징

- Python, OpenAI GPT API, Streamlit/Dash/React(대시보드), DB/캐시, WebSocket 등
- 모든 모듈은 scr 폴더 하위에 위치하며, 사양서와 코드가 세트로 관리됨
- **공통유틸(utils) 모듈(설정, 로깅, 에러처리 등)은 시스템 전역에서 재사용됨**
- **전략 검증/실험 자동화를 위한 backtest.py(백테스트), simulator.py(시뮬레이션) 모듈이 포함되어 있음**
- 대시보드는 별도 웹앱으로 분리되어 실시간 제어/모니터링 담당
- 규제/법적 검토, 피드백 루프, 동적 전략 조정 등 실제 운영에 필요한 현실적 요소 반영

---

## 5. 리마인드(핵심 요약)

- 도식.md의 플로우차트와 같이, 데이터→전략→실행→피드백→대시보드→피드백 루프까지 전체 자동화
- 예외/실패/규제/사용자 제어 등 실제 운영에 필요한 모든 분기와 예외처리 반영
- 모든 모듈은 scr 폴더 하위에 위치하며, 사양서와 코드가 세트로 관리됨
- GPT가 외부 주입 없이 전략을 직접 생산
- 대시보드는 웹앱으로 분리(현실적, 유지보수 용이)
- 전체 파이프라인이 자동화되어 실시간으로 순환 
- **전략/이벤트/데이터 모듈은 반드시 backtest/simulator로 검증 후 실전 적용** 