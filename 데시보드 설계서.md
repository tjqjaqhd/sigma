# SIGMA 대시보드 설계 명세서

## 버전 관리
| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 0.1.0 | 2024-03-12 | 초기 설계서 작성 | SYSTEM |
| 0.2.0 | 2024-03-12 | 레이아웃 구현 명세 추가 | AI |
| 0.3.0 | 2024-03-12 | 컴포넌트 모듈 사양서 추가 | AI |
| 0.4.0 | 2024-03-12 | 전략 관리 페이지 사양 추가 | AI |
| 0.5.0 | 2024-03-12 | 컴포넌트 구조 정의 추가 | AI |

---

## 0. 컴포넌트 구조 정의

### 0.1 디렉토리 구조
```
src/
├── components/
│   ├── layout/          # 레이아웃 관련 컴포넌트
│   │   ├── Layout.tsx   # 메인 레이아웃
│   │   ├── Header.tsx   # 상단 헤더바
│   │   └── Sidebar.tsx  # 사이드 네비게이션
│   │
│   ├── common/          # 재사용 가능한 공통 컴포넌트
│   │   ├── Button/      # 버튼 관련 컴포넌트
│   │   ├── Card/        # 카드 컴포넌트
│   │   ├── Table/       # 테이블 관련 컴포넌트
│   │   └── Form/        # 폼 관련 컴포넌트
│   │
│   ├── strategy/        # 전략 관련 컴포넌트
│   ├── logs/           # 로그 관련 컴포넌트
│   └── system/         # 시스템 관련 컴포넌트
```

### 0.2 컴포넌트 분류 기준
1. **layout/**
   - 목적: 전체 애플리케이션의 구조를 정의
   - 특징: 한 번만 사용되는 구조적 컴포넌트
   - 예시: Layout, Header, Sidebar

2. **common/**
   - 목적: 재사용 가능한 UI 컴포넌트
   - 특징: 여러 곳에서 공통으로 사용
   - 예시: Button, Card, Table, Form 등

3. **기능별 폴더**
   - 목적: 특정 기능에 관련된 컴포넌트
   - 특징: 해당 기능에서만 사용
   - 예시: StrategyList, LogViewer 등

### 0.3 네이밍 규칙
1. **컴포넌트 파일명**
   - PascalCase 사용
   - 기능을 명확히 표현
   - `.tsx` 확장자 사용

2. **스타일 파일명**
   - 컴포넌트와 동일한 이름
   - `.styles.ts` 확장자 사용

3. **타입 정의 파일명**
   - 컴포넌트와 동일한 이름
   - `.types.ts` 확장자 사용

---

## 1. 기본 레이아웃 구조

### 1.1 공통 레이아웃
- **Header (상단바)**
  - 높이: 64px
  - 구성: 메뉴 토글 버튼, 로고, 타이틀
  - 테마: Material-UI AppBar 사용

- **Sidebar (사이드 메뉴)**
  - 너비: 240px
  - 반응형: 모바일에서 드로어 모드
  - 메뉴 항목:
    - 대시보드 (`/`)
    - 전략 관리 (`/strategy`)
    - 로그 조회 (`/logs`)
    - 설정 (`/settings`)

- **Main Content**
  - 여백: 24px (padding)
  - 반응형 레이아웃 적용
  - 최소 높이: 100vh

### 1.2 페이지별 구조

#### 대시보드 페이지
- 3단 그리드 레이아웃
  - 시스템 상태
  - 실행 중인 전략
  - 최근 로그
- 반응형: xs=12, md=6, lg=4

#### 전략 관리 페이지 (구현 예정)
- 전략 목록 테이블
  - 상태 표시 칼럼
  - 실행/중지 버튼
  - 상세 정보 확장 패널
- 필터링 및 정렬 기능
- 실시간 업데이트

---

## 1. UI 화면 구조 명세서

### 화면 구성
1. **홈 화면**
   - 전체 전략 상태 요약 (실행 중/중지됨 등)
   - 개별 전략 리스트 + 시작/정지 버튼
   - 총 수익률, 포지션 개요

2. **전략 제어 탭**
   - 전략별 상태 표시
   - 우선순위/실행시간 등 정렬 보기
   - 개별 로그 연결, 정지/우선순위 조절 버튼

3. **로그 탭**
   - 실시간 로그 스트림
   - 필터: 전략별, 중요도별 (오류, 경고 등)
   - 자동 스크롤, 최대 100줄 표시

4. **시스템 상태 탭**
   - CPU/RAM 게이지 + 퍼센트(%) 표시
   - Redis, DB, API 연결상태 (Ping 기준)
   - 에러 발생 시 자동 알람

5. **설정 탭**
   - 앱 버전 / 최신 버전 비교
   - [.apk 업데이트] 버튼
   - 운영 가이드 요약 보기

---

## 2. API 연결 사양서

| UI 위치 | API 경로 | 방식 | 설명 |
|---------|----------|------|------|
| 시작 버튼 | `/start` | POST | 전체 전략 실행 요청 |
| 정지 버튼 | `/stop` | POST | 전체 전략 중지 요청 |
| 전략 상태 보기 | `/status` | GET | 전체 전략 상태 목록 조회 |
| 로그 스트림 | `/logs` | GET | 최신 로그 100개 반환 (또는 WebSocket) |
| 시스템 지표 | `/metrics` | GET | CPU, 메모리, 포트 상태 반환 |
| 버전 확인 | `/version` | GET | 현재 앱버전과 서버 최신버전 비교 |

---

## 3. 전략 상태 정의 및 UI 매핑표

| 상태 코드 | UI 색상 | 아이콘 | 설명 |
|------------|---------|--------|------|
| 실행 중 | 초록 | ▶️ | 전략이 실행 중인 상태 |
| 중지됨 | 회색 | ⏹ | 전략이 중지된 상태 |
| 오류 발생 | 빨강 | ❌ | 전략 실행 중 예외 발생 |
| 조정 중 | 노랑 | 🔧 | GPT가 자동으로 파라미터 튜닝 중 |
| 일시 정지 | 파랑 | ⏸ | 임시 중단된 상태 |

---

## 4. 데이터 스키마 예시 (JSON)

```json
{
  "strategy_id": "ema_reversal_btc",
  "status": "실행 중",
  "pnl": 3.45,
  "parameters": {
    "진입 기준값": 0.03,
    "청산 비율": 0.5
  },
  "logs": [
    "11:32: 비트코인 매수 @ 28150",
    "11:36: 비트코인 매도 @ 28420"
  ]
}
```

---

## 5. 알림 / 메시지 정의

| 상황 | 메시지 | 중요도 |
|------|--------|--------|
| 전략 실행 실패 | "전략 실행 중 오류가 발생했습니다." | 매우 높음 |
| 로그 없음 | "최근 로그가 없습니다." | 낮음 |
| 시스템 과부하 | "CPU 사용률이 90%를 초과했습니다." | 주의 |
| 업데이트 필요 | "새 버전이 있습니다. 설치하세요." | 정보 |
| 알림 실패 | "알림 전송 실패 - 재시도 예정" | 오류 |

---

## 1. 컴포넌트 모듈 사양서

### 1.1 Layout 모듈
**위치**: `src/components/layout/Layout.tsx`
**버전**: 1.0.0
**설명**: 전체 애플리케이션의 기본 레이아웃을 정의하는 컴포넌트

#### Props
| 속성 | 타입 | 필수 | 설명 |
|------|------|------|------|
| children | React.ReactNode | Y | 레이아웃 내부에 표시될 컨텐츠 |

#### 상태 관리
| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| sidebarOpen | boolean | true | 사이드바 표시 여부 |

#### 스타일
- 최소 높이: 100vh
- 디스플레이: flex
- 메인 컨텐츠 여백: 24px
- 사이드바 너비: 240px

### 1.2 Header 모듈
**위치**: `src/components/layout/Header.tsx`
**버전**: 1.0.0
**설명**: 상단 헤더바를 구현하는 컴포넌트

#### Props
| 속성 | 타입 | 필수 | 설명 |
|------|------|------|------|
| onSidebarToggle | () => void | Y | 사이드바 토글 핸들러 |

#### 스타일
- 높이: 64px
- 위치: fixed
- z-index: theme.zIndex.drawer + 1
- 배경색: theme.palette.background.paper
- 텍스트 색상: theme.palette.text.primary

### 1.3 Sidebar 모듈
**위치**: `src/components/layout/Sidebar.tsx`
**버전**: 1.0.0
**설명**: 네비게이션 메뉴를 포함한 사이드바 컴포넌트

#### Props
| 속성 | 타입 | 필수 | 설명 |
|------|------|------|------|
| open | boolean | Y | 사이드바 열림 상태 |
| onClose | () => void | Y | 사이드바 닫기 핸들러 |

#### 네비게이션 항목
| 텍스트 | 경로 | 아이콘 |
|--------|------|--------|
| 대시보드 | / | DashboardIcon |
| 전략 관리 | /strategy | TimelineIcon |
| 로그 조회 | /logs | StorageIcon |
| 설정 | /settings | SettingsIcon |

#### 반응형 동작
- 모바일(sm 이하): temporary 드로어
- 데스크톱(sm 초과): permanent 드로어

#### 스타일
- 너비: 240px
- 배경색: theme.palette.background.default
- 테두리: theme.palette.divider

### 1.4 전략 관리 페이지 모듈
**위치**: `src/pages/strategy/Strategy.tsx`
**버전**: 1.0.0
**설명**: 전략 목록과 제어 기능을 제공하는 페이지 컴포넌트

#### 컴포넌트 구조
1. **필터/검색 영역**
   - 검색 입력창
   - 상태별 필터 버튼
   - 정렬 기준 선택기

2. **전략 목록 테이블**
   - 열 구성:
     | 열 이름 | 설명 | 정렬 가능 |
     |---------|------|------------|
     | 상태 | 전략 실행 상태 아이콘 | Y |
     | 전략 ID | 전략 고유 식별자 | Y |
     | 수익률 | 현재 수익률 (%) | Y |
     | 실행 시간 | 전략 시작 시간 | Y |
     | 제어 | 실행/중지 버튼 | N |

3. **상세 정보 패널**
   - 확장 가능한 패널 형태
   - 표시 정보:
     - 전략 파라미터
     - 최근 거래 내역
     - 성능 지표
     - 로그 미리보기

#### 상태 관리
| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| strategies | Strategy[] | [] | 전략 목록 데이터 |
| loading | boolean | false | 데이터 로딩 상태 |
| error | string | null | 에러 메시지 |
| selectedStrategy | string | null | 선택된 전략 ID |
| filters | FilterState | defaultFilters | 필터 설정 |

#### API 연동
1. **전략 목록 조회**
   - 엔드포인트: GET `/api/strategies`
   - 응답: Strategy[]
   - 갱신 주기: 5초

2. **전략 제어**
   - 시작: POST `/api/strategies/:id/start`
   - 중지: POST `/api/strategies/:id/stop`
   - 파라미터 수정: PUT `/api/strategies/:id`

#### 이벤트 처리
| 이벤트 | 처리 내용 |
|--------|-----------|
| 전략 선택 | 상세 정보 패널 토글 |
| 실행/중지 | API 호출 및 상태 업데이트 |
| 필터 변경 | 목록 필터링 및 재정렬 |
| 검색어 입력 | 디바운스 처리 후 필터링 |

#### 스타일
- 테이블 최대 높이: 70vh
- 스크롤: 가상 스크롤 적용
- 행 높이: 48px
- 상태 아이콘 크기: 24px
- 패널 전환: 애니메이션 적용
